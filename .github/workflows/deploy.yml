name: Deploy to Neocities

on:
  # push trigger disabled â€” re-enable when ready to deploy:
  #   push:
  #     branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true  # Enable Git LFS for large map files

      - name: Prepare dist
        run: |
          rsync -a \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='.gitignore' \
            --exclude='.gitattributes' \
            --exclude='.agent' \
            --exclude='node_modules' \
            --exclude='package.json' \
            --exclude='package-lock.json' \
            --exclude='scripts' \
            --exclude='*.mbtiles' \
            --exclude='*.geojson' \
            --exclude='*.tif' \
            --exclude='*.zip' \
            --exclude='*.csv' \
            . dist/

      - name: Deploy to Neocities
        uses: bcomnes/deploy-to-neocities@v2
        with:
          api_token: ${{ secrets.NEOCITIES_API_TOKEN }}
          cleanup: true  # One-off: clear existing site contents before deploy
          dist_dir: dist
