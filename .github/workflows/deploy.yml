name: Deploy to Neocities

on:
  # push trigger disabled â€” re-enable when ready to deploy:
  #   push:
  #     branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true  # Enable Git LFS for large map files

      - name: Prepare dist
        run: |
          rsync -a \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='.gitignore' \
            --exclude='.gitattributes' \
            . dist/

      - name: Deploy to Neocities
        uses: bcomnes/deploy-to-neocities@v2
        with:
          api_key: ${{ secrets.NEOCITIES_API_TOKEN }}
          cleanup: true  # One-off: clear existing site contents before deploy
          dist_dir: dist
