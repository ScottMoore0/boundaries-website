<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="News and updates from the Boundaries Website â€” new maps, data corrections, and feature announcements.">
    <title>News - Boundaries Website</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">

    <style>
        .page-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-8);
        }

        .page-header {
            margin-bottom: var(--space-8);
        }

        .page-title {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-4);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            color: var(--color-text-muted);
            margin-bottom: var(--space-4);
        }

        .breadcrumb a {
            color: var(--color-primary-light);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb__separator {
            color: var(--color-text-muted);
        }

        /* Post listing */
        .posts-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .post-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .post-card:hover {
            border-color: var(--color-primary-200);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .post-card__title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
            line-height: var(--leading-tight);
        }

        .post-card__date {
            font-size: var(--text-sm);
            color: var(--color-text-muted);
            margin-bottom: var(--space-3);
        }

        .post-card__summary {
            font-size: var(--text-sm);
            color: var(--color-text);
            line-height: var(--leading-relaxed);
        }

        .post-card__tags {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
            flex-wrap: wrap;
        }

        .post-card__tag {
            font-size: var(--text-xs);
            color: var(--color-primary-light);
            background: var(--color-primary-50);
            padding: 2px 8px;
            border-radius: var(--radius-full);
        }

        /* Post detail view */
        .post-detail {
            display: none;
        }

        .post-detail.active {
            display: block;
        }

        .post-detail__back {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            color: var(--color-primary-light);
            text-decoration: none;
            margin-bottom: var(--space-6);
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
        }

        .post-detail__back:hover {
            text-decoration: underline;
        }

        .post-detail__title {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-2);
        }

        .post-detail__date {
            font-size: var(--text-sm);
            color: var(--color-text-muted);
            margin-bottom: var(--space-8);
        }

        .post-detail__content {
            line-height: var(--leading-relaxed);
        }

        .post-detail__content h1 {
            font-size: var(--text-3xl);
            margin: var(--space-8) 0 var(--space-4);
            font-weight: var(--font-bold);
        }

        .post-detail__content h2 {
            font-size: var(--text-2xl);
            margin: var(--space-6) 0 var(--space-3);
            font-weight: var(--font-semibold);
        }

        .post-detail__content h3 {
            font-size: var(--text-xl);
            margin: var(--space-4) 0 var(--space-2);
            font-weight: var(--font-semibold);
        }

        .post-detail__content p {
            margin-bottom: var(--space-4);
        }

        .post-detail__content ul,
        .post-detail__content ol {
            margin-bottom: var(--space-4);
            padding-left: var(--space-6);
        }

        .post-detail__content li {
            margin-bottom: var(--space-1);
        }

        .post-detail__content a {
            color: var(--color-primary-light);
            text-decoration: underline;
        }

        .post-detail__content a:hover {
            color: var(--color-accent);
        }

        .post-detail__content strong {
            font-weight: var(--font-semibold);
        }

        .post-detail__content em {
            font-style: italic;
        }

        .post-detail__content code {
            background: var(--color-surface-elevated);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
        }

        .post-detail__content blockquote {
            border-left: 3px solid var(--color-primary-200);
            padding-left: var(--space-4);
            color: var(--color-text-muted);
            margin: var(--space-4) 0;
        }

        .post-detail__content hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: var(--space-8) 0;
        }

        .post-detail__content img {
            max-width: 100%;
            border-radius: var(--radius-lg);
            margin: var(--space-4) 0;
        }
    </style>
</head>

<body style="overflow: auto; height: auto;">
    <header class="app-header">
        <a href="../index.html" class="app-header__brand">
            <img src="../assets/images/logo.png" alt="" class="app-header__logo" width="40" height="40">
            <span>Boundaries Website</span>
        </a>

        <nav class="app-header__nav" aria-label="Main navigation">
            <a href="../index.html" class="app-header__link">Home</a>
            <a href="news.html" class="app-header__link app-header__link--active">News</a>
            <a href="about.html" class="app-header__link">About</a>
        </nav>
    </header>

    <main class="page-container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href="../index.html">Home</a>
            <span class="breadcrumb__separator">/</span>
            <span>News</span>
        </nav>

        <header class="page-header">
            <h1 class="page-title">News</h1>
            <p style="color: var(--color-text-muted); max-width: 700px;">
                Updates, announcements, and notes about new maps and features on the Boundaries Website.
            </p>
        </header>

        <!-- Post Listing -->
        <div id="postsList" class="posts-list">
            <!-- Loading skeleton -->
            <div class="post-card">
                <div class="skeleton" style="height: 80px;"></div>
            </div>
        </div>

        <!-- Post Detail View -->
        <div id="postDetail" class="post-detail">
            <button class="post-detail__back" id="backToList">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to all posts
            </button>
            <h1 class="post-detail__title" id="postTitle"></h1>
            <p class="post-detail__date" id="postDate"></p>
            <div class="post-detail__content" id="postContent"></div>
        </div>
    </main>

    <script>
        let postsData = null;

        async function init() {
            try {
                const response = await fetch('../data/database/posts.json');
                postsData = await response.json();
                renderPosts();
            } catch (err) {
                console.error('Failed to load posts:', err);
                document.getElementById('postsList').innerHTML =
                    '<p style="color: var(--color-error);">Failed to load posts. Please refresh.</p>';
            }
        }

        function renderPosts() {
            const container = document.getElementById('postsList');
            container.innerHTML = '';

            // Sort posts by date (newest first)
            const posts = [...(postsData.posts || [])].sort((a, b) =>
                new Date(b.date) - new Date(a.date)
            );

            if (posts.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-muted);">No posts yet.</p>';
                return;
            }

            posts.forEach(post => {
                const card = document.createElement('article');
                card.className = 'post-card';
                card.innerHTML = `
                    <h2 class="post-card__title">${escapeHtml(post.title)}</h2>
                    <p class="post-card__date">${formatDate(post.date)}</p>
                    <p class="post-card__summary">${escapeHtml(post.summary)}</p>
                    ${post.tags ? `<div class="post-card__tags">${post.tags.map(t =>
                    `<span class="post-card__tag">${escapeHtml(t)}</span>`
                ).join('')}</div>` : ''}
                `;
                card.addEventListener('click', () => showPost(post));
                container.appendChild(card);
            });
        }

        async function showPost(post) {
            const listEl = document.getElementById('postsList');
            const detailEl = document.getElementById('postDetail');
            const headerEl = document.querySelector('.page-header');

            listEl.style.display = 'none';
            if (headerEl) headerEl.style.display = 'none';
            detailEl.classList.add('active');

            document.getElementById('postTitle').textContent = post.title;
            document.getElementById('postDate').textContent = formatDate(post.date);
            document.getElementById('postContent').innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch(post.file);
                const markdown = await response.text();
                document.getElementById('postContent').innerHTML = parseMarkdown(markdown);
            } catch (err) {
                console.error('Failed to load post:', err);
                document.getElementById('postContent').innerHTML =
                    '<p style="color: var(--color-error);">Failed to load post content.</p>';
            }
        }

        document.getElementById('backToList').addEventListener('click', () => {
            document.getElementById('postsList').style.display = '';
            document.querySelector('.page-header').style.display = '';
            document.getElementById('postDetail').classList.remove('active');
        });

        /**
         * Lightweight Markdown to HTML parser
         * Handles: headings, bold, italic, links, images, lists, code blocks, blockquotes, hr
         */
        function parseMarkdown(md) {
            let html = '';
            const lines = md.split('\n');
            let inCodeBlock = false;
            let inList = false;
            let listType = '';

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                // Code blocks
                if (line.trim().startsWith('```')) {
                    if (inCodeBlock) {
                        html += '</code></pre>';
                        inCodeBlock = false;
                    } else {
                        html += '<pre><code>';
                        inCodeBlock = true;
                    }
                    continue;
                }
                if (inCodeBlock) {
                    html += escapeHtml(line) + '\n';
                    continue;
                }

                // Close list if non-list line
                if (inList && !line.match(/^\s*[-*]\s/) && !line.match(/^\s*\d+\.\s/) && line.trim() !== '') {
                    html += listType === 'ul' ? '</ul>' : '</ol>';
                    inList = false;
                }

                // Blank line
                if (line.trim() === '') {
                    if (inList) {
                        html += listType === 'ul' ? '</ul>' : '</ol>';
                        inList = false;
                    }
                    continue;
                }

                // Horizontal rule
                if (line.trim().match(/^[-*_]{3,}$/)) {
                    html += '<hr>';
                    continue;
                }

                // Headings
                const headingMatch = line.match(/^(#{1,6})\s+(.+)/);
                if (headingMatch) {
                    const level = headingMatch[1].length;
                    html += `<h${level}>${inlineFormat(headingMatch[2])}</h${level}>`;
                    continue;
                }

                // Blockquote
                if (line.trim().startsWith('> ')) {
                    html += `<blockquote><p>${inlineFormat(line.trim().substring(2))}</p></blockquote>`;
                    continue;
                }

                // Unordered list
                const ulMatch = line.match(/^\s*[-*]\s+(.+)/);
                if (ulMatch) {
                    if (!inList || listType !== 'ul') {
                        if (inList) html += listType === 'ul' ? '</ul>' : '</ol>';
                        html += '<ul>';
                        inList = true;
                        listType = 'ul';
                    }
                    html += `<li>${inlineFormat(ulMatch[1])}</li>`;
                    continue;
                }

                // Ordered list
                const olMatch = line.match(/^\s*\d+\.\s+(.+)/);
                if (olMatch) {
                    if (!inList || listType !== 'ol') {
                        if (inList) html += listType === 'ul' ? '</ul>' : '</ol>';
                        html += '<ol>';
                        inList = true;
                        listType = 'ol';
                    }
                    html += `<li>${inlineFormat(olMatch[1])}</li>`;
                    continue;
                }

                // Regular paragraph
                html += `<p>${inlineFormat(line)}</p>`;
            }

            if (inList) html += listType === 'ul' ? '</ul>' : '</ol>';
            if (inCodeBlock) html += '</code></pre>';

            return html;
        }

        function inlineFormat(text) {
            // Images: ![alt](url)
            text = text.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
            // Links: [text](url)
            text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
            // Bold: **text**
            text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            // Italic: *text*
            text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            // Inline code: `text`
            text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
            return text;
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr + 'T00:00:00');
            return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        init();
    </script>
</body>

</html>